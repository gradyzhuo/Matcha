#!/bin/bash -l
#
# .prefix
#
# Matcha 1.0, Created by gradyzhuo, enoch_lee.
# Copyright Â© 2017, Matcha Inc. All rights reserved.
#

declare -x MATCHA_BUILDER_BASE
declare -x COMMAND_BASE

declare -f @exec

function @exec() {
  PARAMS="$@"
  command="$1"
  declare -i cmd_len=${#command}+2
  declare -i params_len=${#PARAMS}
  PARAMS=$( echo $PARAMS | cut -c $cmd_len-$params_len )

  PREVIOUS_COMMAND_BASE="$COMMAND_BASE"
  COMMAND_BASE="$MATCHA_BUILDER_BASE/exec/$command"
  pushd "$COMMAND_BASE" >> /dev/null
  source main $PARAMS
  popd >> /dev/null
  if [[ "$PREVIOUS_COMMAND_BASE" != "" ]]; then
    COMMAND_BASE="$PREVIOUS_COMMAND_BASE"
  fi
}
